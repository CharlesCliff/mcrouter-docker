mcrouter:
  image: jamescarr/mcrouter:1.0.0
  ports:
    - "5000"
  links:
    - memcache0
    - memcache1
  command: mcrouter -f /etc/mcrouter/mcrouter.json -p 5000 --big-value-split-threshold=800000 --send-invalid-route-to-default --num_proxies=$(nproc)
  volumes:
    - ./etc:/etc/mcrouter/
    - /var/run/spool

zkmcrouter:
  build: .
  environment:
    ZK_HOSTS: zookeeper:2181
    ZK_CONFIG_PATH: /us-east-1/mcrouter
    ZK_CONFIG_OUTPUT: /etc/mcrouter/mcrouter.json
  volumes:
    - .:/app
  volumes_from:
    - mcrouter
  links:
    - zookeeper

zookeeper:
  image: netflixoss/exhibitor:1.5.2
  ports:
    - "2181:2181"
    - "2888:2888"
    - "3888:3888"
    - "8181:8181"
    - "8080:8080"

memcache0:
  image: sylvainlasnier/memcached
  ports:
    - "11211"

memcache1:
  image: sylvainlasnier/memcached
  ports:
    - "11211"

